<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Taskbar Diagnostic - Build 20250821</title>
  <link rel="stylesheet" href="style.css">
  <style>
    .diagnostic {
      background: #f0f0f0;
      padding: 15px;
      margin: 10px;
      border: 1px solid #ccc;
      font-family: monospace;
      font-size: 12px;
    }
    .error { color: red; }
    .success { color: green; }
    .info { color: blue; }
  </style>
</head>
<body>

<h1>Taskbar Loading Diagnostic</h1>

<div class="diagnostic" id="diagnostic-output">
  Starting diagnostic...<br>
</div>

<div id="post-content">
  <h2 id="post-title">Waiting for taskbar...</h2>
  <div id="post-date">-</div>
  <div>Taskbar should appear above this content</div>
</div>

<!-- Load modules one by one with detailed logging -->
<script>
function log(message, type = 'info') {
  const output = document.getElementById('diagnostic-output');
  const time = new Date().toLocaleTimeString();
  output.innerHTML += `<span class="${type}">[${time}] ${message}</span><br>`;
  console.log(`[${time}] ${message}`);
}

// Override console to capture all logs
const originalLog = console.log;
const originalError = console.error;
console.log = function(...args) {
  log(`CONSOLE: ${args.join(' ')}`, 'info');
  originalLog.apply(console, args);
};
console.error = function(...args) {
  log(`ERROR: ${args.join(' ')}`, 'error');
  originalError.apply(console, args);
};

// Check for existing taskbar
function checkTaskbar() {
  const menuBar = document.querySelector('.menu-bar');
  if (menuBar) {
    log('✓ Taskbar found in DOM', 'success');
    
    const buttons = [
      { id: 'star-button', name: 'Star' },
      { id: 'random-post', name: 'Random' },
      { id: 'most-recent-post', name: 'Most Recent' }
    ];
    
    buttons.forEach(({id, name}) => {
      const btn = document.getElementById(id);
      log(`${name} button: ${btn ? 'FOUND' : 'MISSING'}`, btn ? 'success' : 'error');
    });
  } else {
    log('✗ Taskbar NOT found in DOM', 'error');
  }
}

// Check modules loading
function checkModules() {
  log('--- Module Status ---', 'info');
  
  if (window.ppPage) {
    log('✓ ppPage core available', 'success');
    
    const modules = ['posts', 'navigation', 'editor', 'theme', 'taskbar', 'console'];
    modules.forEach(name => {
      const module = window.ppPage.getModule(name);
      log(`${name} module: ${module ? 'LOADED' : 'MISSING'}`, module ? 'success' : 'error');
    });
  } else {
    log('✗ ppPage core NOT available', 'error');
  }
  
  if (window.TaskbarModule) {
    log('✓ TaskbarModule global available', 'success');
  } else {
    log('✗ TaskbarModule global NOT available', 'error');
  }
}

// Load scripts manually with detailed logging
const scripts = [
  'modules/core.js?v=20250821',
  'modules/posts.js?v=20250821', 
  'modules/navigation.js?v=20250821',
  'modules/editor.js?v=20250821',
  'modules/theme.js?v=20250821',
  'modules/taskbar.js?v=20250821',
  'modules/console.js?v=20250821',
  'modules/app.js?v=20250821'
];

let loadedCount = 0;

function loadNextScript() {
  if (loadedCount >= scripts.length) {
    log('All scripts loaded, checking final state...', 'info');
    setTimeout(() => {
      checkModules();
      checkTaskbar();
    }, 1000);
    return;
  }
  
  const scriptSrc = scripts[loadedCount];
  log(`Loading: ${scriptSrc}`, 'info');
  
  const script = document.createElement('script');
  script.src = scriptSrc;
  
  script.onload = () => {
    log(`✓ Loaded: ${scriptSrc}`, 'success');
    loadedCount++;
    
    // Check state after key modules
    if (scriptSrc.includes('core.js')) {
      setTimeout(() => {
        log(`ppPage after core.js: ${window.ppPage ? 'AVAILABLE' : 'NOT AVAILABLE'}`, 
          window.ppPage ? 'success' : 'error');
      }, 100);
    }
    
    if (scriptSrc.includes('taskbar.js')) {
      setTimeout(() => {
        log(`TaskbarModule after taskbar.js: ${window.TaskbarModule ? 'AVAILABLE' : 'NOT AVAILABLE'}`, 
          window.TaskbarModule ? 'success' : 'error');
        checkTaskbar();
      }, 100);
    }
    
    if (scriptSrc.includes('app.js')) {
      setTimeout(() => {
        log('App.js loaded, checking final initialization...', 'info');
        checkModules();
        checkTaskbar();
      }, 2000);
    }
    
    setTimeout(loadNextScript, 200);
  };
  
  script.onerror = () => {
    log(`✗ Failed to load: ${scriptSrc}`, 'error');
    loadedCount++;
    setTimeout(loadNextScript, 200);
  };
  
  document.head.appendChild(script);
}

// Start loading
log('Starting script loading sequence...', 'info');
loadNextScript();

// Periodic checks
setInterval(() => {
  checkTaskbar();
}, 3000);
</script>

</body>
</html>
