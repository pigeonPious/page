<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>üö® Critical Menu Click Debug - Build 20250818</title>
  <link rel="stylesheet" href="style.css?v=20250818">
  <style>
    .debug-panel {
      position: fixed;
      top: 50px;
      right: 10px;
      width: 500px;
      background: #fff;
      border: 2px solid #ff0000;
      padding: 15px;
      max-height: 80vh;
      overflow-y: auto;
      z-index: 10000;
      font-family: monospace;
      font-size: 11px;
    }
    .log-critical { background: #ffebee; color: #c62828; border-left: 4px solid #c62828; padding: 5px; margin: 2px 0; }
    .log-info { background: #e3f2fd; color: #1565c0; border-left: 4px solid #1565c0; padding: 5px; margin: 2px 0; }
    .log-success { background: #e8f5e8; color: #2e7d32; border-left: 4px solid #2e7d32; padding: 5px; margin: 2px 0; }
    .log-warning { background: #fff3e0; color: #ef6c00; border-left: 4px solid #ef6c00; padding: 5px; margin: 2px 0; }
    .test-button { margin: 5px; padding: 8px 12px; font-size: 12px; }
  </style>
</head>
<body>

<div class="page-container">
  <main class="main-column">
    <header class="post-header">
      <h1>üö® Critical Menu Click Debug</h1>
      <div class="post-date">Build 20250818 - Diagnosing menu click failures</div>
    </header>
    <section class="post-content">
      <h2>Instructions:</h2>
      <ol>
        <li><strong>Try clicking ANY menu in the taskbar above</strong></li>
        <li>Watch the debug panel ‚Üí for real-time analysis</li>
        <li>Report what you see in the logs</li>
      </ol>
      
      <h3>Expected: Menu dropdowns should appear when clicked</h3>
      <h3>If they don't appear, this tool will tell us exactly why</h3>
      
      <button class="test-button" onclick="forceMenuTest()">üîß Force Menu Test</button>
      <button class="test-button" onclick="inspectTaskbar()">üîç Inspect Taskbar</button>
      <button class="test-button" onclick="testEventListeners()">üëÇ Test Event Listeners</button>
    </section>
  </main>
</div>

<div class="debug-panel">
  <h4>üö® CRITICAL DEBUG LOG</h4>
  <div id="debug-log"></div>
</div>

<!-- PPPage Modular System -->
<script src="modules/core.js?v=20250818"></script>
<script src="modules/posts.js?v=20250818"></script>
<script src="modules/navigation.js?v=20250818"></script>
<script src="modules/editor.js?v=20250818"></script>
<script src="modules/theme.js?v=20250818"></script>
<script src="modules/taskbar.js?v=20250818"></script>
<script src="modules/console.js?v=20250818"></script>
<script src="modules/app.js?v=20250818"></script>

<script>
let logCount = 0;

function criticalLog(message, type = 'info') {
  logCount++;
  const debugLog = document.getElementById('debug-log');
  const entry = document.createElement('div');
  entry.className = `log-${type}`;
  entry.innerHTML = `<strong>[${logCount}]</strong> ${new Date().toLocaleTimeString()}: ${message}`;
  debugLog.appendChild(entry);
  debugLog.scrollTop = debugLog.scrollHeight;
  
  console.log(`[CRITICAL-${type.toUpperCase()}] ${message}`);
}

function inspectTaskbar() {
  criticalLog('üîç STARTING TASKBAR INSPECTION', 'info');
  
  const menuBar = document.querySelector('.menu-bar');
  if (!menuBar) {
    criticalLog('‚ùå CRITICAL: .menu-bar not found in DOM!', 'critical');
    return;
  }
  
  criticalLog('‚úÖ .menu-bar found in DOM', 'success');
  
  const menuItems = document.querySelectorAll('.menu-item');
  criticalLog(`Found ${menuItems.length} .menu-item elements`, 'info');
  
  if (menuItems.length === 0) {
    criticalLog('‚ùå CRITICAL: No .menu-item elements found!', 'critical');
    return;
  }
  
  menuItems.forEach((item, index) => {
    const label = item.querySelector('.label');
    const dropdown = item.querySelector('.menu-dropdown');
    const labelText = label ? label.textContent.trim() : 'NO LABEL';
    
    criticalLog(`Menu ${index + 1}: "${labelText}"`, 'info');
    criticalLog(`  - Has .label: ${!!label}`, label ? 'success' : 'critical');
    criticalLog(`  - Has .menu-dropdown: ${!!dropdown}`, dropdown ? 'success' : 'critical');
    
    if (label) {
      criticalLog(`  - data-menu attribute: ${label.hasAttribute('data-menu')}`, label.hasAttribute('data-menu') ? 'success' : 'warning');
      criticalLog(`  - onclick property: ${!!label.onclick}`, label.onclick ? 'info' : 'warning');
    }
    
    if (dropdown) {
      const computedStyle = window.getComputedStyle(dropdown);
      criticalLog(`  - Dropdown display: ${computedStyle.display}`, 'info');
      criticalLog(`  - Dropdown position: ${computedStyle.position}`, 'info');
    }
  });
}

function testEventListeners() {
  criticalLog('üëÇ TESTING EVENT LISTENERS', 'info');
  
  const menuItems = document.querySelectorAll('.menu-item');
  
  menuItems.forEach((item, index) => {
    const label = item.querySelector('.label');
    if (label) {
      const labelText = label.textContent.trim();
      
      // Test if click works
      criticalLog(`Testing click on "${labelText}"...`, 'info');
      
      // Add a test listener
      const testHandler = (e) => {
        criticalLog(`‚úÖ CLICK EVENT FIRED for "${labelText}"!`, 'success');
        label.removeEventListener('click', testHandler);
      };
      
      label.addEventListener('click', testHandler);
      
      // Trigger click programmatically
      try {
        label.click();
        
        setTimeout(() => {
          const isOpen = item.classList.contains('open');
          criticalLog(`"${labelText}" open state after click: ${isOpen}`, isOpen ? 'success' : 'critical');
          
          if (!isOpen) {
            criticalLog(`‚ùå MENU "${labelText}" DID NOT OPEN!`, 'critical');
          }
        }, 50);
        
      } catch (error) {
        criticalLog(`‚ùå ERROR clicking "${labelText}": ${error.message}`, 'critical');
      }
    }
  });
}

function forceMenuTest() {
  criticalLog('üîß FORCE TESTING MENU SYSTEM', 'info');
  
  const firstMenuItem = document.querySelector('.menu-item');
  if (!firstMenuItem) {
    criticalLog('‚ùå No menu items to test!', 'critical');
    return;
  }
  
  const label = firstMenuItem.querySelector('.label');
  const labelText = label ? label.textContent.trim() : 'Unknown';
  
  criticalLog(`Force testing "${labelText}" menu...`, 'info');
  
  // Test 1: Manual class manipulation
  criticalLog('Test 1: Manual class manipulation...', 'info');
  firstMenuItem.classList.add('open');
  
  setTimeout(() => {
    const isOpen = firstMenuItem.classList.contains('open');
    criticalLog(`Manual class test result: ${isOpen}`, isOpen ? 'success' : 'critical');
    
    if (isOpen) {
      const dropdown = firstMenuItem.querySelector('.menu-dropdown');
      if (dropdown) {
        const computedStyle = window.getComputedStyle(dropdown);
        const isVisible = computedStyle.display !== 'none';
        criticalLog(`Dropdown visible after manual open: ${isVisible}`, isVisible ? 'success' : 'critical');
      }
    }
    
    // Clean up
    firstMenuItem.classList.remove('open');
  }, 100);
}

// Monitor ALL clicks on the page
document.addEventListener('click', (e) => {
  const target = e.target;
  
  if (target.classList.contains('label')) {
    criticalLog(`üñ±Ô∏è CLICK DETECTED on label: "${target.textContent.trim()}"`, 'info');
  }
  
  if (target.closest('.menu-item')) {
    const menuItem = target.closest('.menu-item');
    const label = menuItem.querySelector('.label');
    const labelText = label ? label.textContent.trim() : 'Unknown';
    criticalLog(`üñ±Ô∏è CLICK DETECTED in menu area: "${labelText}"`, 'info');
  }
}, true); // Use capture phase

// Monitor class changes
const observer = new MutationObserver((mutations) => {
  mutations.forEach((mutation) => {
    if (mutation.type === 'attributes' && mutation.attributeName === 'class') {
      const target = mutation.target;
      if (target.classList.contains('menu-item')) {
        const label = target.querySelector('.label');
        const labelText = label ? label.textContent.trim() : 'Unknown';
        const isOpen = target.classList.contains('open');
        criticalLog(`üìã CLASS CHANGE: "${labelText}" menu ${isOpen ? 'OPENED' : 'CLOSED'}`, isOpen ? 'success' : 'info');
      }
    }
  });
});

// Start monitoring after modules load
setTimeout(() => {
  criticalLog('üöÄ CRITICAL DEBUG SYSTEM STARTED', 'info');
  criticalLog('üëÄ Monitoring all menu interactions...', 'info');
  
  // Start monitoring
  const menuItems = document.querySelectorAll('.menu-item');
  menuItems.forEach(item => {
    observer.observe(item, { attributes: true });
  });
  
  criticalLog(`üì° Monitoring ${menuItems.length} menu items`, 'info');
  
  // Auto-inspect on load
  setTimeout(() => {
    inspectTaskbar();
  }, 1000);
  
}, 2000);

// Override console methods to capture module logs
const originalLog = console.log;
const originalError = console.error;

console.log = function(...args) {
  const message = args.join(' ');
  if (message.includes('menu') || message.includes('Menu') || message.includes('dropdown') || message.includes('click')) {
    criticalLog(`üîß MODULE: ${message}`, 'info');
  }
  originalLog.apply(console, args);
};

console.error = function(...args) {
  const message = args.join(' ');
  criticalLog(`üí• ERROR: ${message}`, 'critical');
  originalError.apply(console, args);
};
</script>

</body>
</html>
