<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Box Style 1 FLAGS Test</title>
  <link rel="icon" href="data:,">
  <link rel="stylesheet" href="editor.css">
</head>
<body>

<!-- Taskbar will be loaded by shared-taskbar.js -->

<div class="frame">
  <main class="center-content">
    <div class="editor-main-column">
      <div class="editor-header">
        <input type="text" id="postTitle" class="title-input" placeholder="Box Style 1 FLAGS Test" value="Box Style 1 FLAGS Test">
      </div>
      
      <div class="editor-main">
        <div id="visualEditor" class="visual-editor" contenteditable="true">
          <h1>Testing Box Style 1 FLAGS Input</h1>
          <p>This test verifies that the FLAGS button now uses Box Style 1 instead of a modal.</p>
          
          <h2>Test Instructions:</h2>
          <ol>
            <li>Click the FLAGS button in the sidebar â†’</li>
            <li>Should see a Box Style 1 popup near the cursor (not a modal)</li>
            <li>Type some keywords like: <code>testing, box-style-1, devlog:TestProject</code></li>
            <li>Press Enter to save</li>
            <li>The FLAGS value should update in the sidebar</li>
          </ol>
          
          <h2>Features:</h2>
          <ul>
            <li>âœ… Box Style 1 popup instead of modal</li>
            <li>âœ… No image confirmation popup when adding images</li>
            <li>âœ… Consistent UX with other editor inputs</li>
          </ul>
        </div>
      </div>
    </div>
  </main>
  
  <div class="editor-sidebar">
    <div class="editor-tools-vertical">
      <div class="tool-button" id="keywords-btn">
        FLAGS
        <span class="tool-value" id="current-keywords">general</span>
      </div>
      
      <div class="tool-button" id="images-btn">
        IMAGES
        <span class="tool-value">Manage Images</span>
      </div>
      
      <div class="tool-button" id="export-btn">
        EXPORT
      </div>
      
      <div class="tool-button" id="test-both-btn">
        TEST BOTH
      </div>
    </div>
  </div>
</div>

<!-- Box Style 1 Inputs -->
<div id="noteInputBox" class="box-style-1 hidden">
  <input type="text" placeholder="Enter your note..." maxlength="200">
</div>

<div id="publishInputBox" class="box-style-1 hidden">
  <input type="text" placeholder="Commit message (optional)..." maxlength="100">
</div>

<div id="exportInputBox" class="box-style-1 hidden">
  <input type="text" placeholder="Filename (optional)..." maxlength="50">
</div>

<div id="keywordsInputBox" class="box-style-1 hidden">
  <input type="text" placeholder="e.g. devlog:ProjectName, programming, design" maxlength="200">
</div>

<div id="messageBox" class="box-style-1 message-box hidden">
  <span class="message-text">Message will appear here</span>
</div>

<script src="shared-taskbar.js"></script>

<script>
// Test editor for Box Style 1 FLAGS functionality
const testEditor = {
  currentKeywords: 'general',

  init() {
    // Set initial keywords
    document.getElementById('current-keywords').textContent = this.currentKeywords;
    
    // Setup event listeners
    document.getElementById('keywords-btn').addEventListener('click', () => this.showKeywordsInput());
    document.getElementById('export-btn').addEventListener('click', () => this.testExport());
    document.getElementById('images-btn').addEventListener('click', () => this.testImageAddition());
    document.getElementById('test-both-btn').addEventListener('click', () => this.testBothFeatures());
    
    console.log('Box Style 1 FLAGS test editor initialized');
  },

  showKeywordsInput() {
    this.showBoxInput('keywordsInputBox', (keywords) => {
      if (keywords.trim()) {
        this.currentKeywords = keywords.trim();
        document.getElementById('current-keywords').textContent = this.currentKeywords;
        console.log('Keywords updated via Box Style 1:', this.currentKeywords);
        this.showBoxMessage(`âœ… FLAGS updated: "${this.currentKeywords}"`);
      }
    }, this.currentKeywords || 'general');
  },

  testExport() {
    this.showBoxInput('exportInputBox', (filename) => {
      console.log('Export filename:', filename);
      this.showBoxMessage(`âœ… Export test: "${filename || 'default-filename'}"`);
    }, 'box-style-1-test');
  },

  testImageAddition() {
    // Simulate image addition without popup
    const testImageData = {
      name: 'test-image.png',
      url: 'assets/sample.gif',
      path: 'assets/test-image.png'
    };
    
    console.log('Simulating image addition:', testImageData);
    
    // Image added silently - no confirmation popup
    this.showBoxMessage('âœ… Image added silently (no popup)');
  },

  testBothFeatures() {
    // Test both FLAGS and silent image addition
    this.showBoxMessage('ðŸ§ª Testing both features...');
    
    setTimeout(() => {
      this.testImageAddition();
    }, 1000);
    
    setTimeout(() => {
      this.showKeywordsInput();
    }, 2000);
  },

  // Box Style 1 Input System (simplified version)
  showBoxInput(boxId, onConfirm, initialValue = '') {
    const box = document.getElementById(boxId);
    const input = box.querySelector('input');
    
    // Position the box near the cursor or button
    let x = window.lastMouseX || 200;
    let y = window.lastMouseY || 200;
    
    box.style.left = x + 'px';
    box.style.top = y + 'px';
    box.classList.remove('hidden');
    
    input.value = initialValue;
    input.focus();
    input.select();
    
    // Handle Enter and Escape
    const handleKeydown = (e) => {
      if (e.key === 'Enter') {
        e.preventDefault();
        const value = input.value.trim();
        this.hideBoxInput(boxId);
        if (onConfirm) onConfirm(value);
        input.removeEventListener('keydown', handleKeydown);
        document.removeEventListener('click', handleClickOutside);
      } else if (e.key === 'Escape') {
        e.preventDefault();
        this.hideBoxInput(boxId);
        input.removeEventListener('keydown', handleKeydown);
        document.removeEventListener('click', handleClickOutside);
      }
    };
    
    // Handle click outside
    const handleClickOutside = (e) => {
      if (!box.contains(e.target)) {
        this.hideBoxInput(boxId);
        input.removeEventListener('keydown', handleKeydown);
        document.removeEventListener('click', handleClickOutside);
      }
    };
    
    input.addEventListener('keydown', handleKeydown);
    setTimeout(() => {
      document.addEventListener('click', handleClickOutside);
    }, 100);
  },

  hideBoxInput(boxId) {
    const box = document.getElementById(boxId);
    box.classList.add('hidden');
  },

  showBoxMessage(message) {
    const box = document.getElementById('messageBox');
    const textSpan = box.querySelector('.message-text');
    
    textSpan.textContent = message;
    
    let x = window.lastMouseX || (window.innerWidth / 2 - 150);
    let y = window.lastMouseY || (window.innerHeight / 3);
    
    x += 10;
    y += 10;
    
    box.style.left = x + 'px';
    box.style.top = y + 'px';
    box.classList.remove('hidden');
    
    setTimeout(() => {
      box.classList.add('hidden');
    }, 3000);
  }
};

// Track mouse position
document.addEventListener('mousemove', (e) => {
  window.lastMouseX = e.clientX;
  window.lastMouseY = e.clientY;
});

// Initialize when DOM is ready
document.addEventListener('DOMContentLoaded', () => {
  testEditor.init();
});
</script>

</body>
</html>
