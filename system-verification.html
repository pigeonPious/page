<!DOCTYPE html>
<html>
<head>
    <title>ppPage Final System Verification</title>
    <style>
        body { 
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', system-ui, sans-serif; 
            margin: 20px; 
            background: #f8f9fa;
        }
        .container { max-width: 1200px; margin: 0 auto; }
        h1 { color: #2c3e50; text-align: center; }
        .test-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin: 20px 0; }
        .test-section { 
            background: white; 
            padding: 20px; 
            border-radius: 8px; 
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .test-section h2 { margin-top: 0; color: #34495e; }
        .status { margin: 5px 0; padding: 8px 12px; border-radius: 4px; font-size: 14px; }
        .success { background: #d4edda; color: #155724; border-left: 4px solid #28a745; }
        .error { background: #f8d7da; color: #721c24; border-left: 4px solid #dc3545; }
        .warning { background: #fff3cd; color: #856404; border-left: 4px solid #ffc107; }
        .info { background: #d1ecf1; color: #0c5460; border-left: 4px solid #17a2b8; }
        button { 
            background: #007bff; 
            color: white; 
            border: none; 
            padding: 10px 16px; 
            border-radius: 4px; 
            cursor: pointer; 
            margin: 5px;
        }
        button:hover { background: #0056b3; }
        button.success { background: #28a745; }
        button.danger { background: #dc3545; }
        .summary { 
            background: #e9ecef; 
            padding: 15px; 
            border-radius: 8px; 
            margin: 20px 0;
            text-align: center;
        }
        .iframe-test { display: none; }
    </style>
</head>
<body>
    <div class="container">
        <h1>üöÄ ppPage System Verification</h1>
        
        <div class="summary" id="summary">
            <p>Comprehensive test of the new modular ppPage architecture</p>
            <p><strong>Status:</strong> <span id="overall-status">Ready to test</span></p>
        </div>
        
        <div class="test-grid">
            <div class="test-section">
                <h2>üè† Main Page (index.html)</h2>
                <button onclick="runMainPageTests()">Test Main Page</button>
                <button onclick="window.open('index.html', '_blank')" class="success">Open Main Page</button>
                <div id="main-results"></div>
            </div>
            
            <div class="test-section">
                <h2>‚úèÔ∏è Editor Page (editor.html)</h2>
                <button onclick="runEditorTests()">Test Editor</button>
                <button onclick="window.open('editor.html', '_blank')" class="success">Open Editor</button>
                <div id="editor-results"></div>
            </div>
        </div>
        
        <div class="test-section">
            <h2>üß™ Comprehensive System Test</h2>
            <button onclick="runFullSystemTest()">Run All Tests</button>
            <button onclick="clearResults()">Clear Results</button>
            <div id="system-results"></div>
        </div>
        
        <div class="test-section">
            <h2>üìã Test Results Summary</h2>
            <div id="test-summary">
                <p>Click "Run All Tests" to see a complete system analysis.</p>
            </div>
        </div>
    </div>
    
    <script>
        let testResults = {
            mainPage: { total: 0, passed: 0, failed: 0 },
            editor: { total: 0, passed: 0, failed: 0 },
            system: { total: 0, passed: 0, failed: 0 }
        };
        
        function log(message, type = 'info', containerId = 'system-results') {
            const div = document.createElement('div');
            div.className = `status ${type}`;
            div.innerHTML = `<strong>${new Date().toLocaleTimeString()}</strong>: ${message}`;
            document.getElementById(containerId).appendChild(div);
            
            // Update test counts
            if (type === 'success') {
                if (containerId.includes('main')) testResults.mainPage.passed++;
                else if (containerId.includes('editor')) testResults.editor.passed++;
                else testResults.system.passed++;
            } else if (type === 'error') {
                if (containerId.includes('main')) testResults.mainPage.failed++;
                else if (containerId.includes('editor')) testResults.editor.failed++;
                else testResults.system.failed++;
            }
            
            updateSummary();
        }
        
        function updateSummary() {
            const total = testResults.mainPage.total + testResults.editor.total + testResults.system.total;
            const passed = testResults.mainPage.passed + testResults.editor.passed + testResults.system.passed;
            const failed = testResults.mainPage.failed + testResults.editor.failed + testResults.system.failed;
            
            document.getElementById('overall-status').textContent = 
                `${passed} passed, ${failed} failed of ${total} tests`;
                
            const summaryDiv = document.getElementById('test-summary');
            summaryDiv.innerHTML = `
                <div class="status ${failed === 0 ? 'success' : failed > passed ? 'error' : 'warning'}">
                    <strong>Overall Status:</strong> ${passed}/${total} tests passed (${failed} failed)
                </div>
                <div class="status info">
                    <strong>Main Page:</strong> ${testResults.mainPage.passed}/${testResults.mainPage.total} passed
                </div>
                <div class="status info">
                    <strong>Editor:</strong> ${testResults.editor.passed}/${testResults.editor.total} passed
                </div>
                <div class="status info">
                    <strong>System:</strong> ${testResults.system.passed}/${testResults.system.total} passed
                </div>
            `;
        }
        
        function runMainPageTests() {
            log('üè† Starting main page tests...', 'info', 'main-results');
            testResults.mainPage = { total: 0, passed: 0, failed: 0 };
            
            const iframe = document.createElement('iframe');
            iframe.src = 'index.html';
            iframe.className = 'iframe-test';
            document.body.appendChild(iframe);
            
            iframe.onload = () => {
                setTimeout(() => {
                    try {
                        const doc = iframe.contentDocument;
                        const win = iframe.contentWindow;
                        
                        // Test 1: Taskbar
                        testResults.mainPage.total++;
                        const taskbar = doc.querySelector('.menu-bar-inner');
                        if (taskbar) {
                            log('‚úÖ Horizontal taskbar loaded', 'success', 'main-results');
                        } else {
                            log('‚ùå Horizontal taskbar not found', 'error', 'main-results');
                        }
                        
                        // Test 2: PPPageCore
                        testResults.mainPage.total++;
                        if (win.PPPageCore) {
                            log('‚úÖ PPPageCore system loaded', 'success', 'main-results');
                        } else {
                            log('‚ùå PPPageCore system not found', 'error', 'main-results');
                        }
                        
                        // Test 3: Posts Module
                        testResults.mainPage.total++;
                        if (win.PPPageCore && win.PPPageCore.modules && win.PPPageCore.modules.posts) {
                            log('‚úÖ Posts module initialized', 'success', 'main-results');
                        } else {
                            log('‚ùå Posts module not initialized', 'error', 'main-results');
                        }
                        
                        // Test 4: Navigation
                        testResults.mainPage.total++;
                        const starButton = doc.getElementById('star-button');
                        if (starButton) {
                            log('‚úÖ Navigation star button found', 'success', 'main-results');
                        } else {
                            log('‚ùå Navigation star button missing', 'error', 'main-results');
                        }
                        
                        // Test 5: Theme system
                        testResults.mainPage.total++;
                        const viewMenu = doc.querySelector('[data-mode]');
                        if (viewMenu) {
                            log('‚úÖ Theme system available', 'success', 'main-results');
                        } else {
                            log('‚ùå Theme system not found', 'error', 'main-results');
                        }
                        
                    } catch (error) {
                        log(`‚ùå Main page test error: ${error.message}`, 'error', 'main-results');
                    }
                    
                    document.body.removeChild(iframe);
                    log('üè† Main page tests completed', 'info', 'main-results');
                }, 2000);
            };
        }
        
        function runEditorTests() {
            log('‚úèÔ∏è Starting editor tests...', 'info', 'editor-results');
            testResults.editor = { total: 0, passed: 0, failed: 0 };
            
            const iframe = document.createElement('iframe');
            iframe.src = 'editor.html';
            iframe.className = 'iframe-test';
            document.body.appendChild(iframe);
            
            iframe.onload = () => {
                setTimeout(() => {
                    try {
                        const doc = iframe.contentDocument;
                        const win = iframe.contentWindow;
                        
                        // Test 1: Editor Module
                        testResults.editor.total++;
                        if (win.EditorModule) {
                            log('‚úÖ EditorModule loaded', 'success', 'editor-results');
                        } else {
                            log('‚ùå EditorModule not found', 'error', 'editor-results');
                        }
                        
                        // Test 2: Global editor instance
                        testResults.editor.total++;
                        if (win.editor || win.editorInstance) {
                            log('‚úÖ Global editor instance available', 'success', 'editor-results');
                        } else {
                            log('‚ùå Global editor instance missing', 'error', 'editor-results');
                        }
                        
                        // Test 3-6: Editor buttons
                        const buttons = [
                            { id: 'keywords-btn', name: 'FLAGS' },
                            { id: 'images-btn', name: 'IMAGES' },
                            { id: 'export-btn', name: 'EXPORT' },
                            { id: 'publish-btn', name: 'PUBLISH' }
                        ];
                        
                        buttons.forEach(({ id, name }) => {
                            testResults.editor.total++;
                            const btn = doc.getElementById(id);
                            if (btn) {
                                log(`‚úÖ ${name} button found and accessible`, 'success', 'editor-results');
                            } else {
                                log(`‚ùå ${name} button missing (${id})`, 'error', 'editor-results');
                            }
                        });
                        
                        // Test 7: Visual editor
                        testResults.editor.total++;
                        const visualEditor = doc.getElementById('visualEditor');
                        if (visualEditor) {
                            log('‚úÖ Visual editor component found', 'success', 'editor-results');
                        } else {
                            log('‚ùå Visual editor component missing', 'error', 'editor-results');
                        }
                        
                        // Test 8: Keywords modal
                        testResults.editor.total++;
                        const keywordsModal = doc.getElementById('keywordsModal');
                        if (keywordsModal) {
                            log('‚úÖ Keywords modal present', 'success', 'editor-results');
                        } else {
                            log('‚ùå Keywords modal missing', 'error', 'editor-results');
                        }
                        
                    } catch (error) {
                        log(`‚ùå Editor test error: ${error.message}`, 'error', 'editor-results');
                    }
                    
                    document.body.removeChild(iframe);
                    log('‚úèÔ∏è Editor tests completed', 'info', 'editor-results');
                }, 2000);
            };
        }
        
        function runFullSystemTest() {
            log('üß™ Starting comprehensive system test...', 'info');
            testResults = {
                mainPage: { total: 0, passed: 0, failed: 0 },
                editor: { total: 0, passed: 0, failed: 0 },
                system: { total: 0, passed: 0, failed: 0 }
            };
            
            // Clear previous results
            document.getElementById('main-results').innerHTML = '';
            document.getElementById('editor-results').innerHTML = '';
            document.getElementById('system-results').innerHTML = '';
            
            // Run tests in sequence
            runMainPageTests();
            setTimeout(() => runEditorTests(), 3000);
            
            // System-wide tests
            setTimeout(() => {
                log('üîß Running system-wide tests...', 'info');
                
                // Test module file existence
                testResults.system.total++;
                fetch('modules/core.js').then(response => {
                    if (response.ok) {
                        log('‚úÖ Core module file accessible', 'success');
                    } else {
                        log('‚ùå Core module file not accessible', 'error');
                    }
                }).catch(() => {
                    log('‚ùå Core module file not found', 'error');
                });
                
                // Test other modules
                const modules = ['posts.js', 'editor.js', 'navigation.js', 'theme.js', 'taskbar.js'];
                modules.forEach(module => {
                    testResults.system.total++;
                    fetch(`modules/${module}`).then(response => {
                        if (response.ok) {
                            log(`‚úÖ ${module} accessible`, 'success');
                        } else {
                            log(`‚ùå ${module} not accessible`, 'error');
                        }
                    }).catch(() => {
                        log(`‚ùå ${module} not found`, 'error');
                    });
                });
                
                log('üß™ System tests completed', 'info');
            }, 6000);
        }
        
        function clearResults() {
            ['main-results', 'editor-results', 'system-results', 'test-summary'].forEach(id => {
                document.getElementById(id).innerHTML = '';
            });
            testResults = {
                mainPage: { total: 0, passed: 0, failed: 0 },
                editor: { total: 0, passed: 0, failed: 0 },
                system: { total: 0, passed: 0, failed: 0 }
            };
            updateSummary();
        }
        
        // Initialize
        window.onload = () => {
            log('üöÄ System verification ready', 'info');
            updateSummary();
        };
    </script>
</body>
</html>
