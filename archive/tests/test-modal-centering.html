<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>🎯 Modal Centering Test</title>
  <link rel="stylesheet" href="style.css">
  <style>
    body {
      padding: 20px;
      font-family: monospace;
      background: var(--bg);
      color: var(--fg);
    }
    .test-container {
      max-width: 800px;
      margin: 0 auto;
      padding: 20px;
      border: 1px solid var(--border);
      border-radius: 5px;
      background: var(--sidebar-bg);
    }
    .test-button {
      padding: 15px 25px;
      margin: 10px;
      background: var(--accent);
      color: var(--bg);
      border: none;
      border-radius: 5px;
      cursor: pointer;
      font-size: 14px;
      font-weight: bold;
    }
    .test-button:hover {
      opacity: 0.8;
    }
    .success {
      background: #28a745;
    }
    .test-log {
      background: var(--bg);
      border: 1px solid var(--border);
      padding: 15px;
      margin: 15px 0;
      border-radius: 5px;
      font-size: 12px;
      max-height: 300px;
      overflow-y: auto;
      white-space: pre-wrap;
    }
    .status {
      display: inline-block;
      padding: 5px 10px;
      border-radius: 3px;
      font-size: 11px;
      font-weight: bold;
      margin-left: 10px;
    }
    .status.pass { background: #28a745; color: white; }
    .status.fail { background: #dc3545; color: white; }
    .status.pending { background: #ffc107; color: black; }
  </style>
</head>
<body class="dark-mode">
  <div class="test-container">
    <h1>🎯 Simple Editor Modal Centering Test</h1>
    <p>This test verifies that all modals in simple-editor.html appear perfectly centered on screen.</p>
    
    <div style="margin: 20px 0;">
      <h3>Export Modal Test <span id="export-status" class="status pending">PENDING</span></h3>
      <p>Test if the export modal appears in the dead center of the screen</p>
      <button class="test-button" onclick="testExportModal()">🧪 Test Export Modal</button>
      <button class="test-button" onclick="testCategoryModal()">🧪 Test Category Modal</button>
      <button class="test-button" onclick="testGitHubModal()">🧪 Test GitHub Modal</button>
      <button class="test-button success" onclick="runAllModalTests()">🚀 Test All Modals</button>
    </div>
    
    <div class="test-log" id="test-log">Ready to test modal positioning...\n</div>
    
    <div style="margin-top: 20px;">
      <h4>Expected Results:</h4>
      <ul style="font-size: 12px; color: var(--muted);">
        <li>✅ Export modal appears perfectly centered vertically and horizontally</li>
        <li>✅ Modal background overlay covers entire screen</li>
        <li>✅ Modal content is clickable and accessible</li>
        <li>✅ No offset to left or right</li>
        <li>✅ Console shows positioning debug info</li>
      </ul>
    </div>
  </div>

<script>
function log(message) {
  const logElement = document.getElementById('test-log');
  const timestamp = new Date().toLocaleTimeString();
  logElement.textContent += `[${timestamp}] ${message}\n`;
  logElement.scrollTop = logElement.scrollHeight;
  console.log(message);
}

function setStatus(testName, status) {
  const statusElement = document.getElementById(testName + '-status');
  if (statusElement) {
    statusElement.className = 'status ' + status;
    statusElement.textContent = status.toUpperCase();
  }
}

function testExportModal() {
  log('🧪 Testing Export Modal positioning...');
  
  // Create iframe to test simple-editor.html
  const iframe = document.createElement('iframe');
  iframe.src = 'simple-editor.html';
  iframe.style.width = '1200px';
  iframe.style.height = '800px';
  iframe.style.border = '1px solid var(--border)';
  iframe.style.display = 'block';
  iframe.style.margin = '20px auto';
  
  iframe.onload = function() {
    try {
      const editorWindow = iframe.contentWindow;
      const editorDoc = iframe.contentDocument;
      
      log('✅ Simple editor loaded in iframe');
      
      // Add some test content to trigger export
      const textarea = editorDoc.getElementById('editorTextarea');
      const titleInput = editorDoc.getElementById('postTitle');
      
      if (textarea && titleInput) {
        textarea.value = 'This is test content for the export modal test.';
        titleInput.value = 'Test Export Modal';
        log('✅ Added test content to editor');
        
        // Wait a moment then trigger export
        setTimeout(() => {
          if (editorWindow.localEditor && editorWindow.localEditor.exportPost) {
            log('🎭 Triggering export modal...');
            editorWindow.localEditor.exportPost();
            
            // Check if modal appeared properly
            setTimeout(() => {
              const exportModal = editorDoc.getElementById('exportModal');
              if (exportModal && exportModal.style.display === 'flex') {
                log('✅ Export modal is visible');
                
                // Check positioning
                const computedStyle = editorWindow.getComputedStyle(exportModal);
                const rect = exportModal.getBoundingClientRect();
                
                log(`📍 Modal position: top=${computedStyle.top}, left=${computedStyle.left}`);
                log(`📍 Modal display: ${computedStyle.display}`);
                log(`📍 Modal bounds: x=${rect.x}, y=${rect.y}, width=${rect.width}, height=${rect.height}`);
                
                if (computedStyle.display === 'flex' && 
                    computedStyle.justifyContent === 'center' && 
                    computedStyle.alignItems === 'center') {
                  log('✅ Modal has correct flexbox centering properties');
                  setStatus('export', 'pass');
                } else {
                  log('❌ Modal lacks proper centering properties');
                  setStatus('export', 'fail');
                }
              } else {
                log('❌ Export modal not visible');
                setStatus('export', 'fail');
              }
            }, 500);
          } else {
            log('❌ localEditor.exportPost not available');
            setStatus('export', 'fail');
          }
        }, 1000);
      } else {
        log('❌ Editor elements not found');
        setStatus('export', 'fail');
      }
    } catch (error) {
      log('❌ Test failed: ' + error.message);
      setStatus('export', 'fail');
    }
  };
  
  // Add iframe to page
  const existingIframe = document.querySelector('iframe');
  if (existingIframe) {
    existingIframe.remove();
  }
  document.body.appendChild(iframe);
}

function testCategoryModal() {
  log('🧪 Testing Category Modal positioning...');
  
  const iframe = document.createElement('iframe');
  iframe.src = 'simple-editor.html';
  iframe.style.width = '1200px';
  iframe.style.height = '800px';
  iframe.style.border = '1px solid var(--border)';
  iframe.style.display = 'block';
  iframe.style.margin = '20px auto';
  
  iframe.onload = function() {
    try {
      const editorWindow = iframe.contentWindow;
      const editorDoc = iframe.contentDocument;
      
      setTimeout(() => {
        if (editorWindow.localEditor && editorWindow.localEditor.showCategoryModal) {
          log('🎭 Triggering category modal...');
          editorWindow.localEditor.showCategoryModal();
          
          setTimeout(() => {
            const categoryModal = editorDoc.getElementById('categoryModal');
            if (categoryModal && categoryModal.style.display === 'flex') {
              log('✅ Category modal positioning test passed');
            } else {
              log('❌ Category modal not properly displayed');
            }
          }, 300);
        }
      }, 1000);
    } catch (error) {
      log('❌ Category modal test failed: ' + error.message);
    }
  };
  
  const existingIframe = document.querySelector('iframe');
  if (existingIframe) {
    existingIframe.remove();
  }
  document.body.appendChild(iframe);
}

function testGitHubModal() {
  log('🧪 Testing GitHub Setup Modal positioning...');
  
  const iframe = document.createElement('iframe');
  iframe.src = 'simple-editor.html';
  iframe.style.width = '1200px';
  iframe.style.height = '800px';
  iframe.style.border = '1px solid var(--border)';
  iframe.style.display = 'block';
  iframe.style.margin = '20px auto';
  
  iframe.onload = function() {
    try {
      const editorWindow = iframe.contentWindow;
      
      setTimeout(() => {
        if (editorWindow.localEditor && editorWindow.localEditor.setupGitHub) {
          log('🎭 Triggering GitHub setup modal...');
          editorWindow.localEditor.setupGitHub();
          
          setTimeout(() => {
            const githubModal = editorWindow.document.getElementById('githubModal');
            if (githubModal && githubModal.style.display === 'flex') {
              log('✅ GitHub modal positioning test passed');
            } else {
              log('❌ GitHub modal not properly displayed');
            }
          }, 300);
        }
      }, 1000);
    } catch (error) {
      log('❌ GitHub modal test failed: ' + error.message);
    }
  };
  
  const existingIframe = document.querySelector('iframe');
  if (existingIframe) {
    existingIframe.remove();
  }
  document.body.appendChild(iframe);
}

function runAllModalTests() {
  log('🚀 Running complete modal positioning test suite...');
  setStatus('export', 'pending');
  
  // Run tests sequentially with delays
  setTimeout(() => testExportModal(), 500);
  setTimeout(() => testCategoryModal(), 3000);
  setTimeout(() => testGitHubModal(), 5000);
  
  setTimeout(() => {
    log('🎯 All modal tests completed! Check the iframe above to see modals in action.');
    log('📝 Note: You can interact with the modals in the iframe to verify they are clickable and properly positioned.');
  }, 7000);
}

// Initialize
log('🎯 Modal centering test page loaded');
log('📋 Tests available: Export Modal, Category Modal, GitHub Setup Modal');
log('🎮 Click buttons above to test individual modals or run all tests');
</script>
</body>
</html>
