<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Menu System Test</title>
  <link rel="icon" href="data:,">
  <link rel="stylesheet" href="style.css">
</head>
<body>

<div class="frame">
  <main class="center-content">
    <div id="post-content">
      <h1>Menu System Test</h1>
      <p>This test focuses specifically on the menu dropdown functionality.</p>
      
      <div id="test-results">
        <h3>Test Results:</h3>
        <div id="test-output">Loading...</div>
      </div>
      
      <div style="margin-top: 20px;">
        <button onclick="testBasicMenuFunction()">Test Basic Menu Function</button>
        <button onclick="manuallyTriggerNavigation()">Manually Trigger Navigation</button>
        <button onclick="checkEventListeners()">Check Event Listeners</button>
      </div>
    </div>
  </main>
</div>

<script src="shared-taskbar.js"></script>

<script>
let testOutput = '';

function log(message) {
  testOutput += `<div>${new Date().toLocaleTimeString()}: ${message}</div>`;
  document.getElementById('test-output').innerHTML = testOutput;
}

function testBasicMenuFunction() {
  log('=== Testing Basic Menu Function ===');
  
  // Check if menu items exist
  const menuItems = document.querySelectorAll('.menu-item');
  log(`Found ${menuItems.length} menu items`);
  
  // Find Navigation menu specifically
  let navigationMenu = null;
  menuItems.forEach((item, index) => {
    const label = item.querySelector('.label');
    const labelText = label ? label.textContent.trim() : '';
    log(`Menu ${index + 1}: "${labelText}"`);
    
    if (labelText === 'Navigation') {
      navigationMenu = item;
      log(`Found Navigation menu at index ${index + 1}`);
    }
  });
  
  if (navigationMenu) {
    const label = navigationMenu.querySelector('.label');
    const dropdown = navigationMenu.querySelector('.menu-dropdown');
    
    log(`Navigation label exists: ${!!label}`);
    log(`Navigation dropdown exists: ${!!dropdown}`);
    log(`Navigation dropdown ID: ${dropdown ? dropdown.id : 'No ID'}`);
    log(`Navigation menu classes: ${navigationMenu.className}`);
    
    // Check if dropdown is hidden/visible
    if (dropdown) {
      const computedStyle = window.getComputedStyle(dropdown);
      log(`Dropdown display: ${computedStyle.display}`);
      log(`Dropdown visibility: ${computedStyle.visibility}`);
      log(`Dropdown opacity: ${computedStyle.opacity}`);
    }
    
    // Try clicking the label
    if (label) {
      log('Clicking Navigation label...');
      label.click();
      
      setTimeout(() => {
        log(`After click - Menu classes: ${navigationMenu.className}`);
        log(`Menu has 'open' class: ${navigationMenu.classList.contains('open')}`);
      }, 100);
    }
  } else {
    log('❌ Navigation menu not found!');
  }
}

function manuallyTriggerNavigation() {
  log('=== Manually Triggering Navigation ===');
  
  const navigationMenu = document.querySelector('.menu-item .label[data-menu]')?.closest('.menu-item');
  if (navigationMenu) {
    // Force toggle
    navigationMenu.classList.toggle('open');
    log(`Manually toggled Navigation menu. Open: ${navigationMenu.classList.contains('open')}`);
  } else {
    log('❌ Could not find Navigation menu to toggle');
  }
}

function checkEventListeners() {
  log('=== Checking Event Listeners ===');
  
  const navigationLabel = Array.from(document.querySelectorAll('.label[data-menu]'))
    .find(label => label.textContent.trim() === 'Navigation');
  
  if (navigationLabel) {
    log('Found Navigation label');
    
    // Check if it has click listeners - this is a basic check
    const hasListeners = navigationLabel.onclick !== null || 
                        navigationLabel.addEventListener !== undefined;
    log(`Has basic event capabilities: ${hasListeners}`);
    
    // Try to manually add a click listener to test
    navigationLabel.addEventListener('click', function testListener(e) {
      log('🎉 TEST: Navigation label clicked!');
      e.stopPropagation();
      
      const menuItem = navigationLabel.closest('.menu-item');
      if (menuItem) {
        menuItem.classList.toggle('open');
        log(`Toggled menu to: ${menuItem.classList.contains('open') ? 'OPEN' : 'CLOSED'}`);
      }
      
      // Remove this test listener
      navigationLabel.removeEventListener('click', testListener);
    });
    
    log('Added test click listener to Navigation label');
  } else {
    log('❌ Navigation label not found');
  }
}

// Wait for taskbar to load and then run initial test
document.addEventListener('DOMContentLoaded', () => {
  setTimeout(() => {
    log('Page loaded, running initial test...');
    testBasicMenuFunction();
  }, 1000);
});
</script>

</body>
</html>
