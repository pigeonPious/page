<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Navigation Menu Debug</title>
  <link rel="icon" href="data:,">
  <link rel="stylesheet" href="style.css">
</head>
<body>

<!-- Taskbar will be loaded by shared-taskbar.js -->

<div class="frame">
  <main class="center-content">
    <div id="post-content">
      <h1>Navigation Menu Debug</h1>
      <p>Testing navigation menu functionality...</p>
      
      <div id="debug-output">
        <h3>Debug Information:</h3>
        <ul id="debug-list">
          <li>Loading...</li>
        </ul>
      </div>
      
      <button onclick="testNavigationMenu()">Test Navigation Menu</button>
      <button onclick="inspectMenuStructure()">Inspect Menu Structure</button>
    </div>
  </main>
</div>

<script src="shared-taskbar.js"></script>
<script src="script.js"></script>

<script>
function addDebugInfo(message) {
  const list = document.getElementById('debug-list');
  const item = document.createElement('li');
  item.textContent = `${new Date().toLocaleTimeString()}: ${message}`;
  list.appendChild(item);
}

function testNavigationMenu() {
  addDebugInfo('=== Testing Navigation Menu ===');
  
  // Check if navigation dropdown exists
  const navDropdown = document.getElementById('navigation-dropdown');
  if (navDropdown) {
    addDebugInfo('✅ Navigation dropdown found');
  } else {
    addDebugInfo('❌ Navigation dropdown NOT found');
  }
  
  // Check if Navigation label exists
  const navLabels = document.querySelectorAll('.label[data-menu]');
  let navLabel = null;
  navLabels.forEach(label => {
    if (label.textContent.trim() === 'Navigation') {
      navLabel = label;
    }
  });
  
  if (navLabel) {
    addDebugInfo('✅ Navigation label found');
    
    // Check if it has click listeners
    const listeners = getEventListeners ? getEventListeners(navLabel) : 'Cannot check listeners';
    addDebugInfo(`Navigation label listeners: ${JSON.stringify(listeners, null, 2)}`);
    
    // Try to trigger click
    addDebugInfo('Triggering click on Navigation label...');
    navLabel.click();
    
    // Check if menu opened
    const menuItem = navLabel.closest('.menu-item');
    if (menuItem && menuItem.classList.contains('open')) {
      addDebugInfo('✅ Navigation menu opened successfully');
    } else {
      addDebugInfo('❌ Navigation menu did NOT open');
    }
  } else {
    addDebugInfo('❌ Navigation label NOT found');
  }
}

function inspectMenuStructure() {
  addDebugInfo('=== Menu Structure Inspection ===');
  
  const menuItems = document.querySelectorAll('.menu-item');
  addDebugInfo(`Found ${menuItems.length} menu items`);
  
  menuItems.forEach((item, index) => {
    const label = item.querySelector('.label');
    const dropdown = item.querySelector('.menu-dropdown');
    const labelText = label ? label.textContent.trim() : 'No label';
    const hasDropdown = dropdown ? 'Yes' : 'No';
    const dropdownId = dropdown ? dropdown.id || 'No ID' : 'N/A';
    
    addDebugInfo(`Menu ${index + 1}: "${labelText}" | Dropdown: ${hasDropdown} | ID: ${dropdownId}`);
    
    if (labelText === 'Navigation' && dropdown) {
      const entries = dropdown.querySelectorAll('.menu-entry');
      addDebugInfo(`  Navigation dropdown has ${entries.length} entries:`);
      entries.forEach((entry, entryIndex) => {
        addDebugInfo(`    ${entryIndex + 1}. "${entry.textContent.trim()}" | ID: ${entry.id || 'No ID'}`);
      });
    }
  });
}

// Auto-run inspection when page loads
document.addEventListener('DOMContentLoaded', () => {
  setTimeout(() => {
    addDebugInfo('Page loaded, starting debug...');
    inspectMenuStructure();
  }, 1000);
});

// Monitor for taskbar loading
const observer = new MutationObserver((mutations) => {
  mutations.forEach((mutation) => {
    if (mutation.type === 'childList') {
      mutation.addedNodes.forEach((node) => {
        if (node.nodeType === Node.ELEMENT_NODE && 
            (node.classList.contains('menu-bar') || node.querySelector('.menu-bar'))) {
          addDebugInfo('Taskbar loaded via MutationObserver');
          setTimeout(inspectMenuStructure, 100);
        }
      });
    }
  });
});

observer.observe(document.body, { childList: true, subtree: true });
</script>

</body>
</html>
