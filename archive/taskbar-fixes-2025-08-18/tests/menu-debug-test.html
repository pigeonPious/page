<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Menu Debug Test - Build 20250818</title>
  <link rel="stylesheet" href="style.css">
  <style>
    .debug-panel {
      position: fixed;
      top: 50px;
      right: 20px;
      width: 400px;
      background: #f9f9f9;
      border: 1px solid #ccc;
      padding: 15px;
      max-height: 70vh;
      overflow-y: auto;
      z-index: 1000;
    }
    .log-entry {
      margin: 3px 0;
      padding: 2px 5px;
      font-size: 12px;
      font-family: monospace;
    }
    .log-info { background: #e3f2fd; }
    .log-success { background: #e8f5e8; }
    .log-error { background: #ffebee; }
    .log-warning { background: #fff3e0; }
    button { margin: 5px; padding: 8px 12px; }
  </style>
</head>
<body>

<div class="page-container">
  <main class="main-column">
    <header class="post-header">
      <h1>Menu Dropdown Debug Test</h1>
      <div class="post-date">Build 20250818 - Testing menu functionality</div>
    </header>
    <section class="post-content">
      <p>Click the menu items in the taskbar above. The debug panel shows real-time information about menu events.</p>
      
      <h3>Expected Behavior:</h3>
      <ul>
        <li>Clicking "File", "Edit", "Navigation", "View", or "Connect" should open dropdown menus</li>
        <li>Only one console window should appear (bottom left)</li>
        <li>Console should show feature descriptions when buttons are clicked</li>
      </ul>
      
      <h3>Manual Tests:</h3>
      <button onclick="testMenuStructure()">Test Menu Structure</button>
      <button onclick="simulateMenuClick()">Simulate Menu Click</button>
      <button onclick="checkConsoleCount()">Check Console Count</button>
      <button onclick="clearLog()">Clear Log</button>
    </section>
  </main>
</div>

<div class="debug-panel">
  <h4>üîç Debug Log</h4>
  <div id="debug-log"></div>
</div>

<!-- PPPage Modular System -->
<script src="modules/core.js?v=20250818"></script>
<script src="modules/posts.js?v=20250818"></script>
<script src="modules/navigation.js?v=20250818"></script>
<script src="modules/editor.js?v=20250818"></script>
<script src="modules/theme.js?v=20250818"></script>
<script src="modules/taskbar.js?v=20250818"></script>
<script src="modules/console.js?v=20250818"></script>
<script src="modules/app.js?v=20250818"></script>

<script>
let logCount = 0;

function log(message, type = 'info') {
  const debugLog = document.getElementById('debug-log');
  const entry = document.createElement('div');
  entry.className = `log-entry log-${type}`;
  entry.textContent = `${new Date().toLocaleTimeString()}: ${message}`;
  debugLog.appendChild(entry);
  debugLog.scrollTop = debugLog.scrollHeight;
  
  console.log(`[${type.toUpperCase()}] ${message}`);
  logCount++;
}

function testMenuStructure() {
  log('üîç Testing menu structure...', 'info');
  
  const menuItems = document.querySelectorAll('.menu-item');
  log(`Found ${menuItems.length} menu items`, 'info');
  
  menuItems.forEach((item, index) => {
    const label = item.querySelector('.label');
    const dropdown = item.querySelector('.menu-dropdown');
    const labelText = label ? label.textContent.trim() : 'No label';
    
    log(`Menu ${index + 1}: "${labelText}" - Has dropdown: ${!!dropdown}`, 'info');
    
    if (label) {
      // Test if click listeners are attached
      const hasClick = label.onclick !== null;
      const events = label._listeners || 'Unknown';
      log(`  - Has onclick: ${hasClick}`, hasClick ? 'success' : 'warning');
      
      // Check for data attributes
      const hasDataMenu = label.hasAttribute('data-menu');
      log(`  - Has data-menu: ${hasDataMenu}`, hasDataMenu ? 'success' : 'warning');
    }
  });
}

function simulateMenuClick() {
  log('üñ±Ô∏è Simulating File menu click...', 'info');
  
  const fileLabel = Array.from(document.querySelectorAll('.label[data-menu]'))
    .find(label => label.textContent.trim() === 'File');
  
  if (fileLabel) {
    log('Found File menu label, triggering click...', 'info');
    fileLabel.click();
    
    setTimeout(() => {
      const menuItem = fileLabel.closest('.menu-item');
      const isOpen = menuItem.classList.contains('open');
      log(`File menu open after click: ${isOpen}`, isOpen ? 'success' : 'error');
    }, 100);
  } else {
    log('File menu label not found', 'error');
  }
}

function checkConsoleCount() {
  const consoles = [
    document.getElementById('persistent-console'),
    document.getElementById('global-console'),
    document.querySelector('.console-output')
  ].filter(Boolean);
  
  log(`Found ${consoles.length} console elements:`, 'info');
  consoles.forEach((console, index) => {
    log(`  Console ${index + 1}: ${console.id || console.className}`, 'info');
  });
}

function clearLog() {
  document.getElementById('debug-log').innerHTML = '';
  logCount = 0;
}

// Monitor menu clicks
document.addEventListener('click', (e) => {
  if (e.target.classList.contains('label')) {
    log(`Menu label clicked: "${e.target.textContent.trim()}"`, 'info');
  }
  
  if (e.target.classList.contains('menu-entry')) {
    log(`Menu entry clicked: "${e.target.textContent.trim()}"`, 'info');
  }
});

// Monitor menu state changes
const observer = new MutationObserver((mutations) => {
  mutations.forEach((mutation) => {
    if (mutation.type === 'attributes' && mutation.attributeName === 'class') {
      const target = mutation.target;
      if (target.classList.contains('menu-item')) {
        const label = target.querySelector('.label');
        const labelText = label ? label.textContent.trim() : 'Unknown';
        const isOpen = target.classList.contains('open');
        log(`Menu "${labelText}" state changed: ${isOpen ? 'OPENED' : 'CLOSED'}`, isOpen ? 'success' : 'info');
      }
    }
  });
});

// Start monitoring after modules load
setTimeout(() => {
  const menuItems = document.querySelectorAll('.menu-item');
  menuItems.forEach(item => {
    observer.observe(item, { attributes: true });
  });
  
  log(`Started monitoring ${menuItems.length} menu items`, 'success');
  log('System ready - try clicking menu items', 'info');
}, 2000);

// Log module loading
document.addEventListener('DOMContentLoaded', () => {
  log('DOM loaded, modules should be initializing...', 'info');
});

// Override console.log to capture module logs
const originalConsoleLog = console.log;
console.log = function(...args) {
  const message = args.join(' ');
  if (message.includes('menu') || message.includes('Menu') || message.includes('dropdown')) {
    log(`Module: ${message}`, 'info');
  }
  originalConsoleLog.apply(console, args);
};
</script>

</body>
</html>
