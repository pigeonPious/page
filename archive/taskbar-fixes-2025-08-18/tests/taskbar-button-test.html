<!DOCTYPE html>
<html>
<head>
    <title>Taskbar Button Test</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .test-section { margin: 20px 0; padding: 15px; border: 1px solid #ddd; border-radius: 5px; }
        .status { margin: 5px 0; padding: 8px; border-radius: 3px; }
        .success { background: #d4edda; color: #155724; }
        .error { background: #f8d7da; color: #721c24; }
        .info { background: #d1ecf1; color: #0c5460; }
        .warning { background: #fff3cd; color: #856404; }
        button { margin: 5px; padding: 8px 12px; cursor: pointer; }
        iframe { width: 100%; height: 400px; border: 1px solid #ccc; margin: 10px 0; }
    </style>
</head>
<body>
    <h1>🔘 Taskbar Button Functionality Test</h1>
    
    <div class="test-section">
        <h2>Automated Tests</h2>
        <button onclick="testTaskbarButtons()">Test Taskbar Button Connections</button>
        <button onclick="testModuleAvailability()">Test Module Availability</button>
        <button onclick="clearResults()">Clear Results</button>
        <div id="results"></div>
    </div>
    
    <div class="test-section">
        <h2>Manual Test - Main Page</h2>
        <p>Use this embedded page to manually test the taskbar buttons:</p>
        <iframe src="index.html" id="main-page-frame"></iframe>
        <p><strong>Instructions:</strong> Click the taskbar buttons above (*, Most Recent, Random Post, All Posts) and check if posts load.</p>
    </div>
    
    <script>
        function log(message, type = 'info') {
            const div = document.createElement('div');
            div.className = `status ${type}`;
            div.innerHTML = `<strong>${new Date().toLocaleTimeString()}</strong>: ${message}`;
            document.getElementById('results').appendChild(div);
        }
        
        function testTaskbarButtons() {
            log('🔘 Testing taskbar button connections...', 'info');
            
            const iframe = document.createElement('iframe');
            iframe.src = 'index.html';
            iframe.style.display = 'none';
            document.body.appendChild(iframe);
            
            iframe.onload = () => {
                setTimeout(() => {
                    try {
                        const doc = iframe.contentDocument;
                        const win = iframe.contentWindow;
                        
                        // Check if modules are loaded
                        if (win.PPPageCore) {
                            log('✅ PPPageCore available', 'success');
                            
                            if (win.PPPageCore.modules) {
                                log('✅ Modules object available', 'success');
                                
                                if (win.PPPageCore.modules.posts) {
                                    log('✅ Posts module loaded', 'success');
                                    
                                    // Check if posts module has required methods
                                    const postsModule = win.PPPageCore.modules.posts;
                                    const requiredMethods = ['loadLatestPost', 'loadRandomPost', 'loadMostRecentPost'];
                                    
                                    requiredMethods.forEach(method => {
                                        if (typeof postsModule[method] === 'function') {
                                            log(`✅ Posts.${method}() method available`, 'success');
                                        } else {
                                            log(`❌ Posts.${method}() method missing`, 'error');
                                        }
                                    });
                                } else {
                                    log('❌ Posts module not loaded', 'error');
                                }
                                
                                if (win.PPPageCore.modules.navigation) {
                                    log('✅ Navigation module loaded', 'success');
                                    
                                    const navModule = win.PPPageCore.modules.navigation;
                                    if (typeof navModule.showAllPostsMenu === 'function') {
                                        log('✅ Navigation.showAllPostsMenu() method available', 'success');
                                    } else {
                                        log('❌ Navigation.showAllPostsMenu() method missing', 'error');
                                    }
                                } else {
                                    log('❌ Navigation module not loaded', 'error');
                                }
                            } else {
                                log('❌ Modules object not available', 'error');
                            }
                        } else {
                            log('❌ PPPageCore not available', 'error');
                        }
                        
                        // Test button elements
                        const buttons = [
                            { id: 'star-button', name: 'Star Button (*)' },
                            { id: 'random-post', name: 'Random Post' },
                            { id: 'most-recent-post', name: 'Most Recent' },
                            { id: 'all-posts-menu', name: 'All Posts' }
                        ];
                        
                        buttons.forEach(({ id, name }) => {
                            const btn = doc.getElementById(id);
                            if (btn) {
                                log(`✅ ${name} element found`, 'success');
                                
                                // Check if button has event listeners
                                const hasListeners = btn._listeners || btn.onclick || btn.addEventListener;
                                if (hasListeners) {
                                    log(`✅ ${name} appears to have event listeners`, 'success');
                                } else {
                                    log(`⚠️ ${name} may not have event listeners`, 'warning');
                                }
                            } else {
                                log(`❌ ${name} element not found (${id})`, 'error');
                            }
                        });
                        
                    } catch (error) {
                        log(`❌ Test error: ${error.message}`, 'error');
                    }
                    
                    document.body.removeChild(iframe);
                }, 3000); // Wait longer for modules to initialize
            };
        }
        
        function testModuleAvailability() {
            log('🧩 Testing module loading timing...', 'info');
            
            const iframe = document.createElement('iframe');
            iframe.src = 'index.html';
            iframe.style.display = 'none';
            document.body.appendChild(iframe);
            
            iframe.onload = () => {
                // Test at different intervals to see when modules become available
                let testCount = 0;
                const maxTests = 10;
                
                const intervalTest = setInterval(() => {
                    testCount++;
                    const win = iframe.contentWindow;
                    
                    log(`Test ${testCount}: Checking module availability...`, 'info');
                    
                    if (win.PPPageCore && win.PPPageCore.modules && win.PPPageCore.modules.posts) {
                        log(`✅ Modules available after ${testCount * 500}ms`, 'success');
                        clearInterval(intervalTest);
                        document.body.removeChild(iframe);
                    } else if (testCount >= maxTests) {
                        log(`❌ Modules still not available after ${maxTests * 500}ms`, 'error');
                        clearInterval(intervalTest);
                        document.body.removeChild(iframe);
                    }
                }, 500);
            };
        }
        
        function clearResults() {
            document.getElementById('results').innerHTML = '';
        }
        
        // Auto-initialize
        window.onload = () => {
            log('🔘 Taskbar button test ready', 'info');
            log('💡 Click "Test Taskbar Button Connections" to verify button functionality', 'info');
        };
    </script>
</body>
</html>
