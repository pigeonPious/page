<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Taskbar Button Verification - Build 20250821</title>
  <link rel="stylesheet" href="style.css">
  <style>
    .test-panel {
      margin: 20px;
      padding: 15px;
      background: #f9f9f9;
      border: 1px solid #ddd;
      border-radius: 4px;
    }
    .status {
      padding: 8px;
      margin: 5px 0;
      border-radius: 3px;
    }
    .pass { background: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
    .fail { background: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
    .info { background: #d1ecf1; color: #0c5460; border: 1px solid #bee5eb; }
    .test-button {
      margin: 5px;
      padding: 8px 16px;
      background: #28a745;
      color: white;
      border: none;
      border-radius: 4px;
      cursor: pointer;
    }
    .test-button:hover {
      background: #218838;
    }
  </style>
</head>
<body>

<div class="page-container">
  <main class="main-column">
    <header class="post-header">
      <h1>Taskbar Button Verification</h1>
      <div class="post-date">Build 20250821 - Final button fix verification</div>
    </header>
    
    <section class="post-content">
      <div id="post-content">
        <h2 id="post-title">No post loaded yet</h2>
        <div id="post-date">-</div>
        <div id="post-content-body">Buttons will load posts here.</div>
      </div>
      
      <div class="test-panel">
        <h3>Manual Button Tests</h3>
        <p>Click these buttons to test taskbar functionality:</p>
        <button class="test-button" onclick="clickStarButton()">Click Star (*) Button</button>
        <button class="test-button" onclick="clickRandomButton()">Click Random Post Button</button>
        <button class="test-button" onclick="clickMostRecentButton()">Click Most Recent Button</button>
        <button class="test-button" onclick="runSystemCheck()">Run System Check</button>
      </div>
      
      <div class="test-panel">
        <h3>Test Results</h3>
        <div id="test-results"></div>
      </div>
    </section>
  </main>
</div>

<!-- Console for feedback -->
<div id="persistent-console" style="position: fixed; bottom: 20px; left: 20px; right: 20px; height: 150px; background: #1a1a1a; color: #00ff00; font-family: monospace; font-size: 12px; padding: 10px; border-radius: 4px; overflow-y: auto; z-index: 1000;">
  Console: Waiting for modules to load...<br>
</div>

<!-- PPPage Modular System -->
<script src="modules/core.js?v=20250821"></script>
<script src="modules/posts.js?v=20250821"></script>
<script src="modules/navigation.js?v=20250821"></script>
<script src="modules/editor.js?v=20250821"></script>
<script src="modules/theme.js?v=20250821"></script>
<script src="modules/taskbar.js?v=20250821"></script>
<script src="modules/console.js?v=20250821"></script>
<script src="modules/app.js?v=20250821"></script>

<script>
function addTestResult(test, status, details = '') {
  const resultsDiv = document.getElementById('test-results');
  const result = document.createElement('div');
  result.className = `status ${status}`;
  result.innerHTML = `<strong>${test}:</strong> ${status.toUpperCase()}${details ? ' - ' + details : ''}`;
  resultsDiv.appendChild(result);
}

function logToConsole(message) {
  const console = document.getElementById('persistent-console');
  const time = new Date().toLocaleTimeString();
  console.innerHTML += `[${time}] ${message}<br>`;
  console.scrollTop = console.scrollHeight;
}

function clickStarButton() {
  logToConsole('Manual test: Clicking star button...');
  const button = document.getElementById('star-button');
  if (button) {
    button.click();
    logToConsole('Star button clicked');
  } else {
    logToConsole('ERROR: Star button not found');
  }
}

function clickRandomButton() {
  logToConsole('Manual test: Clicking random post button...');
  const button = document.getElementById('random-post');
  if (button) {
    button.click();
    logToConsole('Random post button clicked');
  } else {
    logToConsole('ERROR: Random post button not found');
  }
}

function clickMostRecentButton() {
  logToConsole('Manual test: Clicking most recent button...');
  const button = document.getElementById('most-recent-post');
  if (button) {
    button.click();
    logToConsole('Most recent button clicked');
  } else {
    logToConsole('ERROR: Most recent button not found');
  }
}

function runSystemCheck() {
  logToConsole('Running comprehensive system check...');
  const resultsDiv = document.getElementById('test-results');
  resultsDiv.innerHTML = '';
  
  // Check ppPage system
  if (window.ppPage) {
    addTestResult('PPPage Core', 'pass', 'Core system available');
    
    if (typeof window.ppPage.getModule === 'function') {
      addTestResult('Module System', 'pass', 'getModule function available');
      
      // Check posts module
      const postsModule = window.ppPage.getModule('posts');
      if (postsModule) {
        addTestResult('Posts Module', 'pass', 'Module loaded and accessible');
        
        // Check required methods
        const methods = ['loadLatestPost', 'loadRandomPost', 'loadMostRecentPost'];
        const availableMethods = methods.filter(method => typeof postsModule[method] === 'function');
        
        if (availableMethods.length === methods.length) {
          addTestResult('Posts Methods', 'pass', `All ${methods.length} methods available`);
        } else {
          addTestResult('Posts Methods', 'fail', `Only ${availableMethods.length}/${methods.length} methods found`);
        }
      } else {
        addTestResult('Posts Module', 'fail', 'Module not found');
      }
    } else {
      addTestResult('Module System', 'fail', 'getModule function not available');
    }
  } else {
    addTestResult('PPPage Core', 'fail', 'Core system not available');
  }
  
  // Check taskbar buttons
  const buttons = [
    { id: 'star-button', name: 'Star Button' },
    { id: 'random-post', name: 'Random Post Button' },
    { id: 'most-recent-post', name: 'Most Recent Button' }
  ];
  
  buttons.forEach(({ id, name }) => {
    const button = document.getElementById(id);
    if (button) {
      addTestResult(`${name} DOM`, 'pass', 'Found in DOM');
    } else {
      addTestResult(`${name} DOM`, 'fail', 'Not found in DOM');
    }
  });
  
  logToConsole('System check completed');
}

// Listen for post changes
const observer = new MutationObserver((mutations) => {
  mutations.forEach((mutation) => {
    if (mutation.target.id === 'post-title' && mutation.type === 'childList') {
      logToConsole(`Post title changed to: ${mutation.target.textContent}`);
    }
  });
});

// Start observing
const postTitle = document.getElementById('post-title');
if (postTitle) {
  observer.observe(postTitle, { childList: true, subtree: true });
}

// Auto-run system check after modules load
setTimeout(() => {
  logToConsole('Auto-running system check...');
  runSystemCheck();
}, 4000);
</script>

</body>
</html>
