<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Editor</title>
  <link rel="icon" href="data:,">
  <link rel="stylesheet" href="editor.css">
</head>
<body>

<!-- Taskbar will be loaded by shared-taskbar.js -->

<!-- Main Editor -->
<div class="frame">
  <main class="center-content">
    <div class="editor-main-column">
      <div class="editor-header">
        <input type="text" id="postTitle" class="title-input" placeholder="...">
      </div>
      
      <div class="editor-main">
        <div id="visualEditor" class="visual-editor" contenteditable="true" 
             data-placeholder="Write your post content here using Markdown...

Select text and press Ctrl+M to add notes.">
        </div>
      </div>
    </div>
  </main>
  
  <div class="editor-sidebar">
    <div class="editor-tools-vertical">
      <div class="tool-button" id="category-btn">
        CATEGORY
        <span class="tool-value" id="current-category">General</span>
      </div>
      
      <div class="tool-button" id="export-btn">
        EXPORT
      </div>
      
      <div class="tool-button" id="publish-btn" style="display: none;">
        PUBLISH
      </div>
    </div>
  </div>
</div>

<!-- Security Notice for Public Users -->
<div id="securityNotice" class="modal">
  <div class="modal-content">
    <h3>üîí Security Notice</h3>
    <div style="text-align: left; margin: 15px 0;">
      <p><strong>This editor is safe to use publicly!</strong></p>
      
      <p><strong>For Visitors:</strong></p>
      <ul>
        <li>‚úÖ Read and explore published posts</li>
        <li>‚úÖ Use the editor for local drafts (saved in your browser)</li>
        <li>‚úÖ Export posts as HTML or text files</li>
        <li>‚ùå Cannot publish to this site without GitHub token</li>
      </ul>

      <p><strong>To Publish Your Own Posts:</strong></p>
      <ol>
        <li>Create your own GitHub repository</li>
        <li>Get a GitHub Personal Access Token (with repo permissions)</li>
        <li>Use Connect > Setup GitHub to configure your own publishing</li>
        <li>Your token stays private in YOUR browser only</li>
      </ol>
      
      <p><strong>Privacy:</strong> Your drafts and GitHub tokens are stored locally in your browser and never shared with others.</p>
    </div>
    
    <div class="modal-buttons">
      <button onclick="editor.closeModal('securityNotice')" class="btn primary">Got it!</button>
      <input type="checkbox" id="dontShowAgain" style="margin: 0 5px;"> Don't show again
    </div>
  </div>
</div>

<!-- Category Selection Modal -->
<div id="categoryModal" class="modal">
  <div class="modal-content">
    <h3>Select Category</h3>
    <div class="category-options">
      <div class="category-option" data-category="general">General</div>
      <div class="category-option" data-category="tech">Tech</div>
      <div class="category-option" data-category="personal">Personal</div>
      <div class="category-option" data-category="thoughts">Thoughts</div>
    </div>
    <div class="modal-buttons">
      <button onclick="editor.closeModal('categoryModal')" class="btn">Cancel</button>
    </div>
  </div>
</div>

<!-- GitHub Setup Modal -->
<div id="githubModal" class="modal">
  <div class="modal-content">
    <h3>Setup GitHub Publishing</h3>
    <p>Enter your GitHub details to publish posts directly:</p>
    
    <div style="margin: 15px 0;">
      <label><strong>GitHub Personal Access Token:</strong></label>
      <input type="password" id="github-token" placeholder="ghp_xxxxxxxxxxxx">
      <small style="color: #666;">Create at: <a href="https://github.com/settings/tokens" target="_blank">github.com/settings/tokens</a> (needs repo scope)</small>
    </div>
    
    <div style="margin: 15px 0;">
      <label><strong>Repository:</strong></label>
      <input type="text" id="github-repo" placeholder="username/repository-name">
    </div>
    
    <div style="margin: 15px 0;">
      <label><strong>Branch:</strong></label>
      <input type="text" id="github-branch" value="main">
    </div>
    
    <div class="modal-buttons">
      <button onclick="editor.saveGitHubConfig()" class="btn primary">Save & Test</button>
      <button onclick="editor.closeModal('githubModal')" class="btn">Cancel</button>
    </div>
  </div>
</div>

<!-- Drafts Modal -->
<div id="draftsModal" class="modal">
  <div class="modal-content">
    <h3>Your Drafts</h3>
    <div id="drafts-list"></div>
    <div class="modal-buttons">
      <button onclick="editor.closeModal('draftsModal')" class="btn">Close</button>
    </div>
  </div>
</div>

<!-- Message Modal -->
<div id="messageModal" class="modal">
  <div class="modal-content">
    <h3 id="message-title">Simple Editor</h3>
    <p id="message-content"></p>
    <div class="modal-buttons">
      <button onclick="editor.closeModal('messageModal')" class="btn primary">OK</button>
    </div>
  </div>
</div>

<!-- Box Style 1 Inputs -->
<div id="noteInputBox" class="box-style-1 hidden">
  <input type="text" placeholder="Enter your note..." maxlength="200">
</div>

<div id="publishInputBox" class="box-style-1 hidden">
  <input type="text" placeholder="Commit message (optional)..." maxlength="100">
</div>

<div id="exportInputBox" class="box-style-1 hidden">
  <input type="text" placeholder="Filename (optional)..." maxlength="50">
</div>

<script>
// Simple Editor - Optimized and Clean
const editor = {
  // Core state
  currentCategory: 'general',
  isRawMode: false,
  noteCounter: 1,

  // Initialize editor
  init() {
    this.setupEventListeners();
    // this.setupMenus(); // Disabled - using shared taskbar menu system
    this.setupModalManagement();
    this.checkGitHubConfig();
    console.log('Simple Editor initialized');
    
    // Update the global function now that editor is ready
    window.makeNoteFromTaskbar = () => this.makeNote();
  },

  // Event listeners
  setupEventListeners() {
    // Category button
    document.getElementById('category-btn').addEventListener('mousedown', (e) => {
      e.preventDefault(); // Prevent text deselection
    });
    document.getElementById('category-btn').addEventListener('click', () => this.showModal('categoryModal'));
    
    // Export button
    document.getElementById('export-btn').addEventListener('mousedown', (e) => {
      e.preventDefault(); // Prevent text deselection
    });
    document.getElementById('export-btn').addEventListener('click', () => this.exportPost());
    
    // Publish button
    document.getElementById('publish-btn').addEventListener('mousedown', (e) => {
      e.preventDefault(); // Prevent text deselection
    });
    document.getElementById('publish-btn').addEventListener('click', () => this.publishPost());
    
    // Category options
    document.querySelectorAll('.category-option').forEach(option => {
      option.addEventListener('click', () => {
        this.currentCategory = option.dataset.category;
        document.getElementById('current-category').textContent = 
          option.textContent;
        this.closeModal('categoryModal');
      });
    });

    // Keyboard shortcuts
    document.addEventListener('keydown', (e) => {
      if (e.ctrlKey && e.key === 'm') {
        e.preventDefault();
        this.makeNote();
      }
      if (e.key === 'Escape') {
        this.closeAllModals();
      }
    });
  },

  // Menu system
  setupMenus() {
    document.querySelectorAll('[data-menu]').forEach(menu => {
      menu.addEventListener('mousedown', (e) => {
        e.preventDefault(); // Prevent text deselection
      });
      
      menu.addEventListener('click', (e) => {
        e.stopPropagation();
        
        // Close other menus
        document.querySelectorAll('.menu-item').forEach(item => {
          if (item !== menu.parentElement) {
            item.classList.remove('open');
          }
        });
        
        // Toggle current menu
        menu.parentElement.classList.toggle('open');
      });
    });

    // Prevent text deselection on menu entries too
    document.querySelectorAll('.menu-entry').forEach(entry => {
      entry.addEventListener('mousedown', (e) => {
        e.preventDefault(); // Prevent text deselection
      });
    });

    // Close menus when clicking outside
    document.addEventListener('click', () => {
      document.querySelectorAll('.menu-item').forEach(item => {
        item.classList.remove('open');
      });
    });

    // Mode switching
    document.querySelectorAll('[data-mode]').forEach(modeBtn => {
      modeBtn.addEventListener('click', () => {
        const mode = modeBtn.dataset.mode;
        document.body.className = mode === 'dark' ? 'dark-mode' : '';
      });
    });
  },

  // Modal management
  setupModalManagement() {
    // Click outside to close
    document.querySelectorAll('.modal').forEach(modal => {
      modal.addEventListener('click', (e) => {
        if (e.target === modal) {
          this.closeModal(modal.id);
        }
      });
    });
  },

  showModal(modalId) {
    const modal = document.getElementById(modalId);
    if (!modal) return;
    
    // Force reset all positioning
    modal.style.cssText = '';
    modal.classList.add('show');
    
    console.log(`Showing modal: ${modalId}`);
  },

  closeModal(modalId) {
    const modal = document.getElementById(modalId);
    if (!modal) return;
    
    modal.classList.remove('show');
    console.log(`Closed modal: ${modalId}`);
  },

  closeAllModals() {
    document.querySelectorAll('.modal').forEach(modal => {
      modal.classList.remove('show');
    });
  },

  // Box Style 1 Input System
  showBoxInput(boxId, onConfirm, initialValue = '') {
    const box = document.getElementById(boxId);
    const input = box.querySelector('input');
    
    // Position the box near the cursor or button
    const selection = window.getSelection();
    let x = 100, y = 100;
    
    if (selection.rangeCount > 0) {
      const range = selection.getRangeAt(0);
      const rect = range.getBoundingClientRect();
      x = rect.left;
      y = rect.bottom + 5;
    }
    
    box.style.left = x + 'px';
    box.style.top = y + 'px';
    box.classList.remove('hidden');
    
    input.value = initialValue;
    input.focus();
    input.select();
    
    // Handle Enter and Escape
    const handleKeydown = (e) => {
      if (e.key === 'Enter') {
        e.preventDefault();
        const value = input.value.trim();
        this.hideBoxInput(boxId);
        if (onConfirm) onConfirm(value);
        input.removeEventListener('keydown', handleKeydown);
        document.removeEventListener('click', handleClickOutside);
      } else if (e.key === 'Escape') {
        e.preventDefault();
        this.hideBoxInput(boxId);
        input.removeEventListener('keydown', handleKeydown);
        document.removeEventListener('click', handleClickOutside);
      }
    };
    
    // Handle click outside
    const handleClickOutside = (e) => {
      if (!box.contains(e.target)) {
        this.hideBoxInput(boxId);
        input.removeEventListener('keydown', handleKeydown);
        document.removeEventListener('click', handleClickOutside);
      }
    };
    
    input.addEventListener('keydown', handleKeydown);
    setTimeout(() => {
      document.addEventListener('click', handleClickOutside);
    }, 100);
  },

  hideBoxInput(boxId) {
    const box = document.getElementById(boxId);
    box.classList.add('hidden');
  },

  // Document management
  newDocument() {
    document.getElementById('postTitle').value = '';
    document.getElementById('visualEditor').innerHTML = '';
    this.currentCategory = 'general';
    document.getElementById('current-category').textContent = 'General';
    console.log('New document created');
  },

  // Note functionality
  makeNote() {
    console.log('makeNote() called');
    const selection = window.getSelection();
    
    if (selection.rangeCount === 0) {
      this.showMessage('Select some text first to create a note.');
      return;
    }

    const range = selection.getRangeAt(0);
    const selectedText = range.toString().trim();
    
    if (!selectedText) {
      this.showMessage('Please select some text to create a note.');
      return;
    }

    // Store selection data for later use
    this.pendingNoteData = { range, selectedText };
    
    // Show box style 1 input
    this.showBoxInput('noteInputBox', (noteText) => {
      if (!noteText.trim()) return;
      
      // Create note link
      const noteId = `note-${this.noteCounter++}`;
      const noteLink = document.createElement('span');
      noteLink.className = 'note-link';
      noteLink.dataset.noteId = noteId;
      noteLink.dataset.note = noteText;
      noteLink.title = noteText;
      noteLink.textContent = selectedText;

      // Replace selection with note link
      this.pendingNoteData.range.deleteContents();
      this.pendingNoteData.range.insertNode(noteLink);
      
      selection.removeAllRanges();
      console.log(`Created note: ${noteId}`);
    });
  },

  toggleRawMode() {
    this.isRawMode = !this.isRawMode;
    const toggle = document.getElementById('view-mode-toggle');
    toggle.textContent = this.isRawMode ? 'Visual Mode' : 'Raw Mode';
    console.log(`Toggled to ${this.isRawMode ? 'raw' : 'visual'} mode`);
  },

  // Export functionality
  exportPost() {
    const title = document.getElementById('postTitle').value.trim();
    if (!title) {
      this.showMessage('Please enter a title for your post.');
      return;
    }

    const content = document.getElementById('visualEditor').innerHTML;
    if (!content.trim()) {
      this.showMessage('Please write some content for your post.');
      return;
    }

    // Generate default filename
    const defaultFilename = title.toLowerCase().replace(/[^a-z0-9]/g, '-').replace(/-+/g, '-').replace(/^-|-$/g, '');
    
    // Show box style 1 input for filename
    this.showBoxInput('exportInputBox', (filename) => {
      const finalFilename = filename || defaultFilename;
      
      const post = {
        title,
        content,
        category: this.currentCategory,
        date: new Date().toISOString(),
        id: finalFilename,
        notes: this.extractNotes()
      };

      // Download file directly
      const jsonContent = JSON.stringify(post, null, 2);
      const blob = new Blob([jsonContent], { type: 'application/json' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = `${finalFilename}.json`;
      document.body.appendChild(a);
      a.click();
      document.body.removeChild(a);
      URL.revokeObjectURL(url);
      
      this.showMessage(`Exported: ${finalFilename}.json`);
    }, defaultFilename);
  },

  extractNotes() {
    const noteLinks = document.querySelectorAll('.note-link');
    const notes = {};
    noteLinks.forEach(link => {
      notes[link.dataset.noteId] = link.dataset.note;
    });
    return notes;
  },

  copyExport() {
    const content = document.getElementById('exportContent');
    content.select();
    document.execCommand('copy');
    this.showMessage('Exported JSON copied to clipboard!');
  },

  downloadExport() {
    const content = document.getElementById('exportContent').value;
    const filename = document.getElementById('export-filename').textContent;
    
    const blob = new Blob([content], { type: 'application/json' });
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = filename;
    document.body.appendChild(a);
    a.click();
    document.body.removeChild(a);
    URL.revokeObjectURL(url);
    
    this.showMessage('File downloaded successfully!');
  },

  // Draft management
  saveDraft() {
    const title = document.getElementById('postTitle').value.trim() || 'Untitled Draft';
    const content = document.getElementById('visualEditor').innerHTML;
    
    const draft = {
      title,
      content,
      category: this.currentCategory,
      saved: new Date().toISOString()
    };

    const drafts = JSON.parse(localStorage.getItem('drafts') || '[]');
    drafts.push(draft);
    localStorage.setItem('drafts', JSON.stringify(drafts));
    
    this.showMessage(`Draft "${title}" saved successfully!`);
  },

  showDraftsList() {
    const drafts = JSON.parse(localStorage.getItem('drafts') || '[]');
    const list = document.getElementById('drafts-list');
    
    if (drafts.length === 0) {
      list.innerHTML = '<p>No drafts saved yet.</p>';
    } else {
      list.innerHTML = drafts.map((draft, index) => `
        <div style="border: 1px solid var(--border); padding: 10px; margin: 5px 0; border-radius: 3px;">
          <strong>${draft.title}</strong><br>
          <small>Category: ${draft.category} | Saved: ${new Date(draft.saved).toLocaleDateString()}</small><br>
          <button onclick="editor.loadDraft(${index})" class="btn primary" style="margin: 5px 5px 0 0;">Load</button>
          <button onclick="editor.deleteDraft(${index})" class="btn">Delete</button>
        </div>
      `).join('');
    }
    
    this.showModal('draftsModal');
  },

  loadDraft(index) {
    const drafts = JSON.parse(localStorage.getItem('drafts') || '[]');
    const draft = drafts[index];
    
    if (draft) {
      document.getElementById('postTitle').value = draft.title;
      document.getElementById('visualEditor').innerHTML = draft.content;
      this.currentCategory = draft.category;
      document.getElementById('current-category').textContent = 
        draft.category.charAt(0).toUpperCase() + draft.category.slice(1);
      
      this.closeModal('draftsModal');
      this.showMessage('Draft loaded successfully!');
    }
  },

  deleteDraft(index) {
    if (confirm('Are you sure you want to delete this draft?')) {
      const drafts = JSON.parse(localStorage.getItem('drafts') || '[]');
      drafts.splice(index, 1);
      localStorage.setItem('drafts', JSON.stringify(drafts));
      this.showDraftsList(); // Refresh the list
    }
  },

  manageDrafts() {
    this.showDraftsList();
  },

  // GitHub integration
  checkGitHubConfig() {
    const config = this.getGitHubConfig();
    if (config && config.token && config.repo) {
      document.getElementById('github-setup').innerHTML = 
        '<span class="github-connected">‚úÖ GitHub connected</span> ' +
        '<button onclick="editor.setupGitHub()" class="btn" style="margin-left: 10px;">Edit</button>';
      document.getElementById('publish-mode').textContent = 'or publish directly to GitHub!';
      document.getElementById('publish-btn').style.display = 'inline-block';
      document.getElementById('export-btn').classList.remove('primary');
    }
  },

  setupGitHub() {
    const config = this.getGitHubConfig() || {};
    document.getElementById('github-token').value = config.token || '';
    document.getElementById('github-repo').value = config.repo || '';
    document.getElementById('github-branch').value = config.branch || 'main';
    
    this.showModal('githubModal');
  },

  saveGitHubConfig() {
    const token = document.getElementById('github-token').value.trim();
    const repo = document.getElementById('github-repo').value.trim();
    const branch = document.getElementById('github-branch').value.trim() || 'main';

    if (!token || !repo) {
      this.showMessage('Please fill in both token and repository fields.');
      return;
    }

    const config = { token, repo, branch };
    localStorage.setItem('githubConfig', JSON.stringify(config));
    
    this.closeModal('githubModal');
    this.checkGitHubConfig();
    this.showMessage('GitHub configuration saved successfully!');
  },

  getGitHubConfig() {
    try {
      return JSON.parse(localStorage.getItem('githubConfig'));
    } catch {
      return null;
    }
  },

  async publishPost() {
    console.log('publishPost() called!');
    
    const title = document.getElementById('postTitle').value.trim();
    const content = document.getElementById('visualEditor').innerHTML.trim();
    
    if (!title) {
      this.showMessage('Please enter a title for your post.');
      return;
    }
    
    if (!content) {
      this.showMessage('Please write some content for your post.');
      return;
    }

    // Check GitHub config
    const config = this.getGitHubConfig();
    if (!config || !config.token || !config.repo) {
      this.showMessage('Please set up GitHub configuration first. Go to Connect > Setup GitHub.', 'Setup Required');
      return;
    }

    // Show box style 1 input for commit message
    this.showBoxInput('publishInputBox', async (commitMessage) => {
      const finalCommitMessage = commitMessage || `Add post: ${title}`;
      
      // Generate post data
      const slug = this.generateSlug(title);
      const date = new Date().toISOString().split('T')[0];
      const formattedDate = this.formatDateForPost(date);
      
      const postData = {
        title: title,
        content: this.processContent(content),
        category: this.currentCategory,
        date: formattedDate
      };

      console.log('Publishing to GitHub:', postData);

      try {
        // Save post to GitHub with custom commit message
        await this.savePostToGitHub(slug, postData, config, finalCommitMessage);
        
        this.showMessage('Post published successfully to GitHub!', 'üéâ Success');
        
        // Clear editor
        document.getElementById('postTitle').value = '';
        document.getElementById('visualEditor').innerHTML = '';
        this.currentCategory = 'general';
        document.getElementById('current-category').textContent = 'General';
        
      } catch (error) {
        console.error('Error publishing post:', error);
        this.showMessage(error.message || 'Failed to publish post to GitHub.', '‚ùå Error');
      }
    }, `Add post: ${title}`);
  },

  async savePostToGitHub(slug, postData, config, commitMessage = null) {
    const [owner, repo] = config.repo.split('/');
    const branch = config.branch || 'main';
    
    // Use custom commit message or default
    const message = commitMessage || `Add post: ${postData.title}`;
    
    // Save post file
    const postPath = `posts/${slug}.json`;
    const postContent = JSON.stringify(postData, null, 2);
    
    await this.createOrUpdateGitHubFile(
      owner, repo, branch, postPath, 
      message, 
      postContent, config.token
    );

    // Update index
    await this.updatePostIndex(owner, repo, branch, slug, postData, config.token);
  },

  async createOrUpdateGitHubFile(owner, repo, branch, path, message, content, token) {
    // First, try to get the existing file to get its SHA
    let sha = null;
    try {
      const response = await fetch(`https://api.github.com/repos/${owner}/${repo}/contents/${path}?ref=${branch}`, {
        headers: {
          'Authorization': `token ${token}`,
          'Accept': 'application/vnd.github.v3+json'
        }
      });
      
      if (response.ok) {
        const file = await response.json();
        sha = file.sha;
      }
    } catch (error) {
      // File doesn't exist, that's fine
    }

    // Create or update the file
    const payload = {
      message: message,
      content: btoa(content),
      branch: branch
    };
    
    if (sha) {
      payload.sha = sha;
    }

    const response = await fetch(`https://api.github.com/repos/${owner}/${repo}/contents/${path}`, {
      method: 'PUT',
      headers: {
        'Authorization': `token ${token}`,
        'Accept': 'application/vnd.github.v3+json',
        'Content-Type': 'application/json'
      },
      body: JSON.stringify(payload)
    });

    if (!response.ok) {
      const error = await response.json();
      throw new Error(`GitHub API error: ${error.message}`);
    }

    return response.json();
  },

  async updatePostIndex(owner, repo, branch, slug, postData, token) {
    try {
      // Get current index
      const response = await fetch(`https://api.github.com/repos/${owner}/${repo}/contents/posts/index.json?ref=${branch}`, {
        headers: {
          'Authorization': `token ${token}`,
          'Accept': 'application/vnd.github.v3+json'
        }
      });

      let indexContent = [];
      let sha = null;

      if (response.ok) {
        const indexFile = await response.json();
        indexContent = JSON.parse(atob(indexFile.content));
        sha = indexFile.sha;
      }

      // Add new post to index (remove existing if updating)
      indexContent = indexContent.filter(post => post.slug !== slug);
      indexContent.push({
        slug: slug,
        title: postData.title,
        date: postData.date,
        category: postData.category || 'general'
      });

      // Sort by date (newest first)
      indexContent.sort((a, b) => new Date(b.date) - new Date(a.date));

      // Update index file
      await this.createOrUpdateGitHubFile(
        owner, repo, branch, 'posts/index.json',
        `Update index for post: ${postData.title}`,
        JSON.stringify(indexContent, null, 2),
        token
      );

    } catch (error) {
      console.error('Error updating index:', error);
      throw new Error('Failed to update post index');
    }
  },

  formatDateForPost(dateStr) {
    const date = new Date(dateStr);
    const months = ['January', 'February', 'March', 'April', 'May', 'June',
                   'July', 'August', 'September', 'October', 'November', 'December'];
    return `${date.getFullYear()}-${months[date.getMonth()]}-${date.getDate()}`;
  },

  // Helper functions for publishing
  generateSlug(title) {
    return title.toLowerCase()
      .replace(/[^a-z0-9]+/g, '-')
      .replace(/^-+|-+$/g, '');
  },

  processContent(content) {
    // Convert HTML content to preserve formatting and note links
    return content;
  },

  // Utility functions
  showMessage(message, title = 'Simple Editor') {
    document.getElementById('message-title').textContent = title;
    document.getElementById('message-content').textContent = message;
    this.showModal('messageModal');
  }
};

// Initialize when DOM is ready
document.addEventListener('DOMContentLoaded', () => {
  // Make makeNote function available globally BEFORE taskbar loads
  window.makeNoteFromTaskbar = () => {
    if (typeof editor !== 'undefined' && editor.makeNote) {
      editor.makeNote();
    } else {
      console.log('Make note not available yet');
    }
  };
  
  editor.init();
});

// For backwards compatibility
const localEditor = editor;
</script>

<!-- Load shared scripts after the main editor is defined -->
<script>
// Load shared taskbar with error handling
console.log('Loading shared taskbar...');
try {
  // First load the shared taskbar script
  const script1 = document.createElement('script');
  script1.src = 'shared-taskbar.js';
  script1.onload = () => {
    console.log('Shared taskbar script loaded');
    // Then load the main script
    const script2 = document.createElement('script');
    script2.src = 'script.js';
    script2.onload = () => {
      console.log('Main script loaded');
    };
    script2.onerror = (error) => {
      console.error('Failed to load script.js:', error);
    };
    document.head.appendChild(script2);
  };
  script1.onerror = (error) => {
    console.error('Failed to load shared-taskbar.js:', error);
  };
  document.head.appendChild(script1);
} catch (error) {
  console.error('Error loading scripts:', error);
}
</script>

</body>
</html>
