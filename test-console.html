<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Console Test</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <h1>Console Output Test</h1>
  <p>This page tests the persistent console output functionality.</p>
  
  <div style="margin: 20px 0;">
    <button onclick="testDebugMessage()">Test Debug Message</button>
    <button onclick="testFeatureMessage()">Test Feature Message</button>
    <button onclick="testWarningMessage()">Test Warning Message</button>
    <button onclick="testErrorMessage()">Test Error Message</button>
    <button onclick="testLogMessage()">Test ppPage.log()</button>
  </div>

  <!-- Load modules in order -->
  <script src="modules/core.js"></script>
  <script src="modules/console.js"></script>
  
  <script>
    // Wait for page to load
    document.addEventListener('DOMContentLoaded', async () => {
      console.log('Page loaded, initializing console...');
      
      try {
        // Initialize ppPage
        console.log('Initializing ppPage...');
        await ppPage.init();
        console.log('ppPage initialized');
        
        // Register console module
        if (typeof ConsoleModule !== 'undefined') {
          console.log('ConsoleModule found, registering...');
          await ppPage.registerModule('console', ConsoleModule);
          console.log('Console module registered');
          
          // Test if console is available
          const consoleModule = ppPage.getModule('console');
          if (consoleModule) {
            console.log('Console module retrieved successfully');
            consoleModule.addMessage('Console test page loaded successfully!', 'info');
          } else {
            console.error('Console module not available after registration');
          }
        } else {
          console.error('ConsoleModule not found!');
        }
      } catch (error) {
        console.error('Error during initialization:', error);
      }
    });

    function testDebugMessage() {
      try {
        const consoleModule = ppPage.getModule('console');
        if (consoleModule) {
          consoleModule.logDebug('This is a debug message from the test button');
        } else {
          alert('Console module not found!');
        }
      } catch (error) {
        console.error('Error in testDebugMessage:', error);
        alert('Error: ' + error.message);
      }
    }

    function testFeatureMessage() {
      try {
        const consoleModule = ppPage.getModule('console');
        if (consoleModule) {
          consoleModule.logFeature('Test Feature', 'This feature demonstrates console output');
        } else {
          alert('Console module not found!');
        }
      } catch (error) {
        console.error('Error in testFeatureMessage:', error);
        alert('Error: ' + error.message);
      }
    }

    function testWarningMessage() {
      try {
        const consoleModule = ppPage.getModule('console');
        if (consoleModule) {
          consoleModule.logWarning('This is a warning message');
        } else {
          alert('Console module not found!');
        }
      } catch (error) {
        console.error('Error in testWarningMessage:', error);
        alert('Error: ' + error.message);
      }
    }

    function testErrorMessage() {
      try {
        const consoleModule = ppPage.getModule('console');
        if (consoleModule) {
          consoleModule.logError('This is an error message');
        } else {
          alert('Console module not found!');
        }
      } catch (error) {
        console.error('Error in testErrorMessage:', error);
        alert('Error: ' + error.message);
      }
    }

    function testLogMessage() {
      try {
        if (ppPage && ppPage.log) {
          ppPage.log('Testing ppPage.log() integration', 'info');
        } else {
          alert('ppPage.log not found!');
        }
      } catch (error) {
        console.error('Error in testLogMessage:', error);
        alert('Error: ' + error.message);
      }
    }
  </script>
</body>
</html>
